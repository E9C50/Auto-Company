<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Auto-Company Dashboard</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      min-height: 100vh; color: #e0e0e0;
    }
    .container { max-width: 1600px; margin: 0 auto; padding: 20px; }
    
    header {
      display: flex; justify-content: space-between; align-items: center;
      padding: 20px 0; border-bottom: 1px solid #333; margin-bottom: 20px;
    }
    h1 { font-size: 28px; background: linear-gradient(90deg, #00d4ff, #7b2cbf);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    
    .status-badge {
      padding: 8px 16px; border-radius: 20px; font-weight: bold; font-size: 14px;
    }
    .status-running { background: #00c853; color: #000; }
    .status-stopped { background: #ff5252; color: #fff; }
    .status-paused { background: #ffab00; color: #000; }
    .status-error { background: #ff5252; color: #fff; }
    .status-cooldown { background: #2196f3; color: #fff; }
    
    .toolbar {
      display: flex; gap: 10px; flex-wrap: wrap; align-items: center;
      margin-bottom: 20px; padding: 15px; background: rgba(255,255,255,0.05);
      border-radius: 12px;
    }
    .btn {
      padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer;
      font-weight: bold; transition: all 0.2s; font-size: 14px;
    }
    .btn-primary { background: #2196f3; color: white; }
    .btn-primary:hover { background: #1976d2; }
    .btn-success { background: #00c853; color: white; }
    .btn-success:hover { background: #00a043; }
    .btn-warning { background: #ffab00; color: #000; }
    .btn-danger { background: #ff5252; color: white; }
    .btn-danger:hover { background: #ff1744; }
    .btn-secondary { background: #666; color: white; }
    
    select, input {
      padding: 8px 12px; border-radius: 6px; border: 1px solid #444;
      background: #2a2a3e; color: #fff; font-size: 14px;
    }
    select:focus, input:focus { outline: none; border-color: #00d4ff; }
    
    .grid {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px; margin-bottom: 20px;
    }
    .card {
      background: rgba(255,255,255,0.05); border-radius: 12px; padding: 20px;
      border: 1px solid rgba(255,255,255,0.1);
    }
    .card-title { font-size: 12px; color: #888; margin-bottom: 8px; text-transform: uppercase; }
    .card-value { font-size: 32px; font-weight: bold; color: #00d4ff; }
    .card-sub { font-size: 11px; color: #666; margin-top: 5px; }
    
    .tabs {
      display: flex; gap: 5px; margin-bottom: 15px; border-bottom: 1px solid #333; padding-bottom: 10px;
    }
    .tab {
      padding: 10px 20px; border-radius: 8px 8px 0 0; cursor: pointer;
      background: transparent; color: #888; border: none; font-size: 14px;
    }
    .tab.active { background: rgba(255,255,255,0.1); color: #00d4ff; }
    .tab:hover { color: #fff; }
    
    .section {
      background: rgba(255,255,255,0.05); border-radius: 12px; padding: 20px;
      margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.1);
    }
    .section h2 { font-size: 18px; margin-bottom: 15px; color: #fff; display: flex; align-items: center; gap: 10px; }
    
    .log-entry {
      font-family: 'Monaco', 'Menlo', monospace; font-size: 12px;
      padding: 6px 10px; border-bottom: 1px solid rgba(255,255,255,0.05);
      white-space: pre-wrap; word-break: break-all; max-height: 300px; overflow-y: auto;
    }
    .log-entry:last-child { border-bottom: none; }
    .log-debug { color: #666; }
    .log-info { color: #00d4ff; }
    .log-warn { color: #ffab00; }
    .log-error { color: #ff5252; }
    
    .cycle-list, .file-list {
      max-height: 400px; overflow-y: auto;
    }
    .cycle-item, .file-item {
      display: flex; justify-content: space-between; align-items: center;
      padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.1); cursor: pointer;
    }
    .cycle-item:hover, .file-item:hover { background: rgba(255,255,255,0.05); }
    .cycle-item:last-child, .file-item:last-child { border-bottom: none; }
    .cycle-name { font-family: monospace; color: #00d4ff; font-size: 13px; }
    .cycle-meta { font-size: 11px; color: #666; }
    
    .file-tree { font-size: 13px; }
    .file-tree-item {
      padding: 6px 10px; cursor: pointer; display: flex; align-items: center; gap: 8px;
    }
    .file-tree-item:hover { background: rgba(255,255,255,0.05); }
    .file-icon { width: 16px; text-align: center; }
    .folder-icon { color: #ffab00; }
    .file-icon { color: #00d4ff; }
    
    .code-view {
      background: #1a1a2e; padding: 15px; border-radius: 8px;
      font-family: 'Monaco', 'Menlo', monospace; font-size: 12px;
      white-space: pre-wrap; word-break: break-all; max-height: 500px; overflow-y: auto;
    }
    
    .idea-form {
      display: flex; gap: 10px; flex-wrap: wrap;
    }
    .idea-form textarea {
      flex: 1; min-width: 300px; padding: 12px; border-radius: 8px;
      border: 1px solid #444; background: #2a2a3e; color: #fff;
      font-size: 14px; resize: vertical; min-height: 80px;
    }
    .idea-form textarea:focus { outline: none; border-color: #00d4ff; }
    
    .config-form {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }
    .config-form label { display: block; margin-bottom: 5px; font-size: 12px; color: #888; }
    .config-form input, .config-form select { width: 100%; }
    
    .footer {
      text-align: center; padding: 20px; color: #666; font-size: 12px;
    }
    
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    .live-indicator {
      display: inline-block; width: 8px; height: 8px; background: #00c853;
      border-radius: 50%; margin-right: 8px; animation: pulse 2s infinite;
    }
    
    .hidden { display: none !important; }
    
    .modal {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center;
      z-index: 1000;
    }
    .modal-content {
      background: #1a1a2e; padding: 30px; border-radius: 16px; max-width: 90%;
      max-height: 90%; overflow: auto;
    }
    .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .modal-close { background: none; border: none; color: #fff; font-size: 24px; cursor: pointer; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>ü§ñ Auto-Company Dashboard</h1>
      <span id="statusBadge" class="status-badge status-stopped">Stopped</span>
    </header>
    
    <div class="toolbar">
      <button class="btn btn-primary" onclick="refreshAll()">üîÑ Refresh</button>
      <button class="btn btn-success" id="pauseBtn" onclick="togglePause()">‚è∏ Pause</button>
      <button class="btn btn-danger" onclick="stopLoop()">‚èπ Stop</button>
      <button class="btn btn-secondary" onclick="restartLoop()">üîÅ Restart</button>
      
      <div style="flex:1"></div>
      
      <select id="engineSelect" onchange="updateConfig()">
        <option value="codex">Codex</option>
        <option value="claude-code">Claude Code</option>
      </select>
      <input type="text" id="modelInput" placeholder="Model (optional)" style="width:150px" onchange="updateConfig()">
    </div>
    
    <div class="grid">
      <div class="card">
        <div class="card-title">üîÑ Cycle Count</div>
        <div class="card-value" id="loopCount">0</div>
        <div class="card-sub">Total cycles completed</div>
      </div>
      <div class="card">
        <div class="card-title">‚ùå Error Count</div>
        <div class="card-value" id="errorCount">0</div>
        <div class="card-sub">Total errors</div>
      </div>
      <div class="card">
        <div class="card-title">‚è±Ô∏è Last Run</div>
        <div class="card-value" id="lastRun" style="font-size:18px">-</div>
        <div class="card-sub">Last cycle</div>
      </div>
      <div class="card">
        <div class="card-title">‚öôÔ∏è Engine</div>
        <div class="card-value" id="engine" style="font-size:20px">-</div>
        <div class="card-sub">Current AI engine</div>
      </div>
    </div>
    
    <div class="tabs">
      <button class="tab active" onclick="showTab('logs')">üìä Logs</button>
      <button class="tab" onclick="showTab('cycles')">üìà Cycles</button>
      <button class="tab" onclick="showTab('memories')">üß† Memories</button>
      <button class="tab" onclick="showTab('files')">üìÅ Files</button>
      <button class="tab" onclick="showTab('idea')">üí° New Idea</button>
      <button class="tab" onclick="showTab('config')">‚öôÔ∏è Config</button>
    </div>
    
    <!-- Logs Tab -->
    <div id="tab-logs" class="section">
      <h2>üìä Live Logs <span class="live-indicator"></span></h2>
      <div id="logsContainer" class="log-entry">Loading...</div>
    </div>
    
    <!-- Cycles Tab -->
    <div id="tab-cycles" class="section hidden">
      <h2>üìà Cycle History</h2>
      <div id="cyclesContainer" class="cycle-list">Loading...</div>
    </div>
    
    <!-- Memories Tab -->
    <div id="tab-memories" class="section hidden">
      <h2>üß† Consensus & Memories</h2>
      <div id="memoriesContainer" class="file-list">Loading...</div>
      <div style="margin-top:15px">
        <h3>Current Consensus</h3>
        <div id="consensusContent" class="code-view" style="margin-top:10px">Loading...</div>
      </div>
    </div>
    
    <!-- Files Tab -->
    <div id="tab-files" class="section hidden">
      <h2>üìÅ Project Files</h2>
      <div style="margin-bottom:10px">
        <button class="btn btn-secondary" onclick="navigateFiles('')" style="padding:5px 10px;font-size:12px">üè† Root</button>
        <span id="currentPath" style="margin-left:10px;color:#888;font-size:13px"></span>
      </div>
      <div id="filesContainer" class="file-tree">Loading...</div>
      <div id="fileContent" class="code-view hidden" style="margin-top:15px">
        <div style="margin-bottom:10px">
          <button class="btn btn-secondary" onclick="closeFileContent()" style="padding:5px 10px;font-size:12px">‚Üê Back</button>
        </div>
        <pre id="fileContentText"></pre>
      </div>
    </div>
    
    <!-- Idea Tab -->
    <div id="tab-idea" class="section hidden">
      <h2>üí° Submit New Idea</h2>
      <p style="color:#888;margin-bottom:15px">
        Give a vague idea. You can approve and start it manually, or set priority for later execution.
      </p>
      
      <!-- Start Button -->
      <div style="margin-bottom:20px;padding:15px;background:rgba(0,200,83,0.1);border-radius:8px">
        <button class="btn btn-success" onclick="startLoop()">‚ñ∂ Start Loop</button>
        <span style="margin-left:10px;color:#888;font-size:13px">Start the autonomous loop</span>
      </div>
      
      <!-- Pending Ideas -->
      <div style="margin-bottom:20px">
        <h3 style="margin-bottom:10px">üìã Pending Ideas</h3>
        <div id="ideasContainer">Loading...</div>
      </div>
      
      <!-- New Idea Form -->
      <h3 style="margin-bottom:10px">‚ú® New Idea</h3>
      <div class="idea-form">
        <textarea id="ideaText" placeholder="e.g., Build a tool that helps people track their daily habits..."></textarea>
        <div style="display:flex;flex-direction:column;gap:10px">
          <div>
            <label style="font-size:12px;color:#888">Priority (1-10)</label>
            <input type="number" id="ideaPriority" min="1" max="10" value="5" style="width:80px">
          </div>
          <label style="display:flex;align-items:center;gap:8px;cursor:pointer">
            <input type="checkbox" id="ideaStartNow">
            <span style="font-size:13px">Start immediately</span>
          </label>
          <button class="btn btn-primary" onclick="submitIdea()">üíæ Save Idea</button>
        </div>
      </div>
    </div>
    
    <!-- Config Tab -->
    <div id="tab-config" class="section hidden">
      <h2>‚öôÔ∏è Configuration</h2>
      <div class="config-form">
        <div>
          <label>Engine</label>
          <select id="configEngine">
            <option value="codex">Codex</option>
            <option value="claude-code">Claude Code</option>
          </select>
        </div>
        <div>
          <label>Model (optional)</label>
          <input type="text" id="configModel" placeholder="e.g., gpt-4o">
        </div>
        <div>
          <label>Interval (seconds)</label>
          <input type="number" id="configInterval" min="10" value="30">
        </div>
        <div>
          <label>Timeout (seconds)</label>
          <input type="number" id="configTimeout" min="60" value="1800">
        </div>
      </div>
      <button class="btn btn-primary" style="margin-top:20px" onclick="saveConfig()">üíæ Save Config</button>
    </div>
    
    <div class="footer">
      Auto-Company v2.0.0 | <span id="connectionStatus">Connecting...</span>
    </div>
  </div>
  
  <script>
    let ws = null;
    let currentTab = 'logs';
    let currentFilePath = '';
    
    function connectWebSocket() {
      const protocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
      ws = new WebSocket(`${protocol}//${location.host}/ws`);
      
      ws.onopen = () => {
        document.getElementById('connectionStatus').innerHTML = 'üü¢ Connected';
        document.getElementById('connectionStatus').style.color = '#00c853';
      };
      
      ws.onmessage = (event) => {
        const data = JSON.parse(event.data);
        if (data.type === 'state') updateStatus(data);
        if (data.type === 'settings') updateSettings(data);
        if (data.type === 'paused') updatePauseState(data.paused);
        if (data.type === 'idea') showIdeaNotification(data.idea);
      };
      
      ws.onclose = () => {
        document.getElementById('connectionStatus').innerHTML = 'üî¥ Disconnected';
        document.getElementById('connectionStatus').style.color = '#ff5252';
        setTimeout(connectWebSocket, 3000);
      };
    }
    
    function updateStatus(data) {
      document.getElementById('loopCount').textContent = data.loopCount || 0;
      document.getElementById('errorCount').textContent = data.errorCount || 0;
      document.getElementById('lastRun').textContent = data.lastRun ? new Date(data.lastRun).toLocaleString() : '-';
      document.getElementById('engine').textContent = data.engine || '-';
      
      const badge = document.getElementById('statusBadge');
      const status = data.status || 'stopped';
      badge.className = `status-badge status-${status}`;
      badge.textContent = status.charAt(0).toUpperCase() + status.slice(1);
    }
    
    function updateSettings(data) {
      document.getElementById('engineSelect').value = data.engine || 'codex';
      document.getElementById('modelInput').value = data.model || '';
      document.getElementById('configEngine').value = data.engine || 'codex';
      document.getElementById('configModel').value = data.model || '';
      updatePauseState(data.paused);
    }
    
    function updatePauseState(paused) {
      const btn = document.getElementById('pauseBtn');
      if (paused) {
        btn.textContent = '‚ñ∂ Resume';
        btn.className = 'btn btn-success';
      } else {
        btn.textContent = '‚è∏ Pause';
        btn.className = 'btn btn-warning';
      }
    }
    
    function showTab(tab) {
      currentTab = tab;
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
      document.querySelector(`.tab[onclick="showTab('${tab}')"]`).classList.add('active');
      document.getElementById(`tab-${tab}`).classList.remove('hidden');
      
      if (tab === 'logs') refreshLogs();
      if (tab === 'cycles') refreshCycles();
      if (tab === 'memories') refreshMemories();
      if (tab === 'files') refreshFiles();
      if (tab === 'idea') { refreshIdeas(); }
    }
    
    async function refreshAll() {
      await Promise.all([refreshStatus(), refreshSettings()]);
      if (currentTab === 'logs') refreshLogs();
      if (currentTab === 'cycles') refreshCycles();
      if (currentTab === 'memories') refreshMemories();
      if (currentTab === 'files') refreshFiles();
    }
    
    async function refreshStatus() {
      try {
        const res = await fetch('/api/status');
        const data = await res.json();
        updateStatus(data);
      } catch (e) { console.error(e); }
    }
    
    async function refreshSettings() {
      try {
        const res = await fetch('/api/settings');
        const data = await res.json();
        updateSettings(data);
      } catch (e) { console.error(e); }
    }
    
    async function refreshLogs() {
      try {
        const res = await fetch('/api/logs?limit=50');
        const logs = await res.json();
        const container = document.getElementById('logsContainer');
        if (logs.length === 0) {
          container.innerHTML = '<div class="log-entry">No logs yet</div>';
          return;
        }
        container.innerHTML = logs.map(log => {
          let level = 'info';
          if (log.includes('[ERROR]')) level = 'error';
          else if (log.includes('[WARN]')) level = 'warn';
          else if (log.includes('[DEBUG]')) level = 'debug';
          return `<div class="log-entry log-${level}">${escapeHtml(log)}</div>`;
        }).join('');
      } catch (e) { console.error(e); }
    }
    
    async function refreshCycles() {
      try {
        const res = await fetch('/api/cycles');
        const cycles = await res.json();
        const container = document.getElementById('cyclesContainer');
        if (cycles.length === 0) {
          container.innerHTML = '<div class="cycle-item">No cycles yet</div>';
          return;
        }
        container.innerHTML = cycles.map(c => `
          <div class="cycle-item" onclick="viewCycle('${c.name}')">
            <div>
              <div class="cycle-name">${c.name}</div>
              <div class="cycle-meta">${new Date(c.modified).toLocaleString()} | ${formatSize(c.size)}</div>
            </div>
          </div>
        `).join('');
      } catch (e) { console.error(e); }
    }
    
    async function viewCycle(name) {
      try {
        const res = await fetch(`/api/cycle/${name}`);
        const data = await res.json();
        const modal = document.createElement('div');
        modal.className = 'modal';
        modal.innerHTML = `
          <div class="modal-content" style="width:80%;max-width:900px">
            <div class="modal-header">
              <h3>${name}</h3>
              <button class="modal-close" onclick="this.closest('.modal').remove()">√ó</button>
            </div>
            <pre class="code-view" style="max-height:70vh">${escapeHtml(data.content)}</pre>
          </div>
        `;
        document.body.appendChild(modal);
      } catch (e) { console.error(e); }
    }
    
    async function refreshMemories() {
      try {
        // Get files list
        const res = await fetch('/api/memories');
        const files = await res.json();
        const container = document.getElementById('memoriesContainer');
        if (files.length === 0) {
          container.innerHTML = '<div class="file-item">No memory files</div>';
        } else {
          container.innerHTML = files.map(f => `
            <div class="file-item" onclick="viewMemory('${f.path}')">
              <span class="file-icon">${f.type === 'directory' ? 'üìÅ' : 'üìÑ'}</span>
              <span>${f.path}</span>
            </div>
          `).join('');
        }
        
        // Get consensus
        const consensusRes = await fetch('/api/consensus');
        const consensusData = await consensusRes.json();
        document.getElementById('consensusContent').textContent = consensusData.exists ? consensusData.content : 'No consensus yet';
      } catch (e) { console.error(e); }
    }
    
    async function viewMemory(path) {
      try {
        const res = await fetch(`/api/memory/${path}`);
        const data = await res.json();
        const modal = document.createElement('div');
        modal.className = 'modal';
        modal.innerHTML = `
          <div class="modal-content" style="width:80%;max-width:900px">
            <div class="modal-header">
              <h3>${path}</h3>
              <button class="modal-close" onclick="this.closest('.modal').remove()">√ó</button>
            </div>
            <pre class="code-view" style="max-height:70vh">${escapeHtml(data.content)}</pre>
          </div>
        `;
        document.body.appendChild(modal);
      } catch (e) { console.error(e); }
    }
    
    let currentDir = '';
    async function refreshFiles() {
      try {
        const res = await fetch(`/api/files?dir=${encodeURIComponent(currentDir)}`);
        const files = await res.json();
        const container = document.getElementById('filesContainer');
        document.getElementById('currentPath').textContent = currentDir || '/';
        
        if (files.length === 0) {
          container.innerHTML = '<div class="file-tree-item">Empty directory</div>';
          return;
        }
        
        container.innerHTML = files.map(f => `
          <div class="file-tree-item" onclick="${f.type === 'directory' ? `navigateFiles('${f.path}')` : `viewFile('${f.path}')`}">
            <span class="file-icon ${f.type === 'directory' ? 'folder-icon' : 'file-icon'}">${f.type === 'directory' ? 'üìÅ' : 'üìÑ'}</span>
            <span>${f.name}</span>
          </div>
        `).join('');
      } catch (e) { console.error(e); }
    }
    
    function navigateFiles(dir) {
      currentDir = dir;
      refreshFiles();
    }
    
    async function viewFile(filePath) {
      try {
        const res = await fetch(`/api/file/${filePath}`);
        const data = await res.json();
        document.getElementById('filesContainer').classList.add('hidden');
        document.getElementById('fileContent').classList.remove('hidden');
        document.getElementById('fileContentText').textContent = data.content;
      } catch (e) { console.error(e); }
    }
    
    function closeFileContent() {
      document.getElementById('filesContainer').classList.remove('hidden');
      document.getElementById('fileContent').classList.add('hidden');
    }
    
    async function togglePause() {
      try {
        const res = await fetch('/api/settings');
        const data = await res.json();
        if (data.paused) {
          await fetch('/api/resume', { method: 'POST' });
        } else {
          await fetch('/api/pause', { method: 'POST' });
        }
        refreshAll();
      } catch (e) { console.error(e); }
    }
    
    async function stopLoop() {
      if (!confirm('Stop the auto-company loop?')) return;
      await fetch('/api/stop', { method: 'POST' });
    }
    
    async function restartLoop() {
      if (!confirm('Restart the auto-company (will continue from current state)?')) return;
      await fetch('/api/restart', { method: 'POST' });
    }
    
    async function updateConfig() {
      const engine = document.getElementById('engineSelect').value;
      const model = document.getElementById('modelInput').value;
      await fetch('/api/config', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ engine, model })
      });
      alert('Config updated. Restart to apply changes.');
    }
    
    async function saveConfig() {
      const engine = document.getElementById('configEngine').value;
      const model = document.getElementById('configModel').value;
      const interval = document.getElementById('configInterval').value;
      const timeout = document.getElementById('configTimeout').value;
      
      await fetch('/api/config', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ engine, model, interval, timeout })
      });
      alert('Config saved. Restart to apply changes.');
    }
    
    async function submitIdea() {
      const idea = document.getElementById('ideaText').value.trim();
      if (!idea) return alert('Please enter an idea');
      
      const priority = document.getElementById('ideaPriority').value;
      const startNow = document.getElementById('ideaStartNow').checked;
      
      const res = await fetch('/api/idea', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ idea, priority, startNow })
      });
      
      const data = await res.json();
      document.getElementById('ideaText').value = '';
      document.getElementById('ideaStartNow').checked = false;
      alert(data.message);
      refreshIdeas();
    }
    
    async function refreshIdeas() {
      try {
        const res = await fetch('/api/ideas');
        const ideas = await res.json();
        const container = document.getElementById('ideasContainer');
        
        if (ideas.length === 0) {
          container.innerHTML = '<div style="padding:20px;color:#666;text-align:center">No pending ideas</div>';
          return;
        }
        
        container.innerHTML = ideas.map(idea => `
          <div style="padding:15px;background:rgba(255,255,255,0.05);border-radius:8px;margin-bottom:10px">
            <div style="display:flex;justify-content:space-between;align-items:start">
              <div style="flex:1">
                <div style="font-size:14px;margin-bottom:8px">${escapeHtml(idea.idea)}</div>
                <div style="font-size:11px;color:#666">
                  Priority: <span style="color:#00d4ff">${idea.priority}</span> | 
                  Status: <span style="color:${idea.status === 'approved' ? '#00c853' : idea.status === 'rejected' ? '#ff5252' : '#ffab00'}">${idea.status}</span> |
                  Created: ${new Date(idea.createdAt).toLocaleString()}
                </div>
              </div>
              <div style="display:flex;gap:8px">
                ${idea.status === 'pending' ? `
                  <button class="btn btn-success" style="padding:6px 12px;font-size:12px" onclick="approveIdea('${idea.id}')">‚ñ∂ Start</button>
                  <button class="btn btn-secondary" style="padding:6px 12px;font-size:12px" onclick="setPriority('${idea.id}')">‚ö° Priority</button>
                  <button class="btn btn-danger" style="padding:6px 12px;font-size:12px" onclick="rejectIdea('${idea.id}')">‚úï</button>
                ` : ''}
              </div>
            </div>
          </div>
        `).join('');
      } catch (e) { console.error(e); }
    }
    
    async function approveIdea(id) {
      if (!confirm('Approve this idea and start execution?')) return;
      await fetch(`/api/idea/${id}/start`, { method: 'POST' });
      alert('Idea approved! Loop is starting...');
      refreshIdeas();
    }
    
    async function rejectIdea(id) {
      if (!confirm('Reject this idea?')) return;
      await fetch(`/api/idea/${id}/reject`, { method: 'POST' });
      refreshIdeas();
    }
    
    async function setPriority(id) {
      const priority = prompt('Enter priority (1-10, 10 is highest):', '5');
      if (priority === null) return;
      await fetch(`/api/idea/${id}/priority`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ priority })
      });
      refreshIdeas();
    }
    
    async function startLoop() {
      await fetch('/api/start', { method: 'POST' });
      alert('Loop started!');
    }
    
    function showIdeaNotification(idea) {
      alert(`üí° New idea being executed: ${idea.substring(0, 100)}...`);
    }
    
    function formatSize(bytes) {
      if (bytes < 1024) return bytes + ' B';
      if (bytes < 1024*1024) return (bytes/1024).toFixed(1) + ' KB';
      return (bytes/1024/1024).toFixed(1) + ' MB';
    }
    
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
    
    setInterval(refreshAll, 5000);
    connectWebSocket();
    refreshAll();
  </script>
</body>
</html>
